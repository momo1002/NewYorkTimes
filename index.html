<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYT</title>
</head>
<body>
    <div class="controls">
        <form>
            <p>
                <input type="text" id="search" class="search" value="covid" required />
            </p>
            <p>
                <input type="date" id="start-date" class="start-date" pattern="[0-9]{8}">
            </p>
            <p>
                <input type="date" id="end-date" class="end-date" pattern="[0-9]{8}">
            </p>
            <p>
                <button class="submit">Search</button>
            </p>
        </form>
    </div>
    <div class="results">
        <nav>
            <button class="prev">Prev 10</button>
            <button class="next">Next 10</button>
        </nav>

        <section>       
        </section>
    </div>
    <script>

        const baseURL = "https://api.nytimes.com/svc/search/v2/articlesearch.json";
        const API_KEY = "8Mqg6DKG2lQqb7zOkdz7Ghs6Az9GqwqR";
        let url;

        const searchBox = document.querySelector('.search');
        const startDate = document.querySelector('.start-date');
        const endDate   = document.querySelector('.end-date');
        const searchBtn = document.querySelector('form'); 
        const nextBtn   = document.querySelector('.next');
        const prevBtn   = document.querySelector('.prev');

        const section = document.querySelector('section');
        const nav     = document.querySelector('nav');

        searchBtn.addEventListener('submit', submitSearch);
        nextBtn.addEventListener('click', nextPage);
        prevBtn.addEventListener('click', prevPage);

        let pageNumber;
        nav.style.display = "none";

        function submitSearch(e){
            pageNumber = 0;
            nav.style.display = "block";
            fetchResults(e);
        }

        function fetchResults(e){
            e.preventDefault();
            if(pageNumber > 0){
                prevBtn.disabled = false;
                prevBtn.textContent = "Prev10";
            } else {
                prevBtn.disabled = true;
                prevBtn.textContent = "Prev";
            }
            url = baseURL
                + '?api-key=' + API_KEY
                + '&q=' + searchBox.value
                + '&page=' + pageNumber
                + '&fq=document_type:("article")';

            if(startDate.value !== ''){
                url += '&begin_date=' + startDate.value;
            } 
            if(endDate.value !== ''){
                url += '&end_date=' + endDate.value; 
            }

            fetch(url)
            .then(function(result){ return result.json(); })
            .then(function(json){ displayResults(json); })
            .catch(error => console.log(error.message));
        }


        function displayResults(json){
            while (section.firstChild) {
                section.removeChild(section.firstChild);
            }
            const articles = json.response.docs;



            for (let i = 0; i < articles.length; i++) {
                const article = document.createElement('article');
                const link    = document.createElement('a');
                const heading = document.createElement('h2');
                const img     = document.createElement('img');
                const para1   = document.createElement('p');
                const para2   = document.createElement('p');
                const pubdate = document.createElement('span');
                const source  = document.createElement('span'); 
                const current = articles[i];

                link.href = current.web_url;
                link.textContent = current.headline.main;
                para1.textContent = current.snippet;

                for (let j = 0; j < current.keywords.length; j++) {
                    let span = document.createElement('span');
                    span.textContent += current.keywords[j].value + ' / ';
                    para2.appendChild(span);
                }

                img.src = 'http://www.nytimes.com/' +ã€€current.multimedia[19].url;
                img.alt = current.headline.main;

                pubdate.textContent = current.pub_date;
                source.textContent  = current.source;

                article.appendChild(heading);
                heading.appendChild(link);
                article.appendChild(img);
                article.appendChild(para1);
                article.appendChild(para2);
                article.appendChild(pubdate);
                article.appendChild(source);
                section.appendChild(article);
            }
        }

        function nextPage(e){
            pageNumber++;
            fetchResults(e);
        }
        function prevPage(e){
            if(pageNumber > 0){
                pageNumber--;
                fetchResults(e);
            } else {
                prevBtn.disabled = true;
            }
        }

    </script>
</body>
</html>